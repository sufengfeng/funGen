C51 COMPILER V9.60.0.0   TIMER                                                             08/31/2020 23:19:03 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE TIMER
OBJECT MODULE PLACED IN timer.OBJ
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE timer.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.\SRC) DEBUG OBJECTEXTEND TABS(2
                    -)

line level    source

   1          
   2          /*------------------------------------------------------------------*/
   3          /* --- STC MCU International Limited -------------------------------*/
   4          /* --- STC 1T Series MCU RC Demo -----------------------------------*/
   5          /* --- Mobile: (86)13922805190 -------------------------------------*/
   6          /* --- Fax: 86-0513-55012956,55012947,55012969 ---------------------*/
   7          /* --- Tel: 86-0513-55012928,55012929,55012966 ---------------------*/
   8          /* --- Web: www.GXWMCU.com -----------------------------------------*/
   9          /* --- QQ:  800003751 ----------------------------------------------*/
  10          /* If you want to use the program or the program referenced in the  */
  11          /* article, please specify in which data and procedures from STC    */
  12          /*------------------------------------------------------------------*/
  13          
  14          /*************  功能说明  **************
  15          
  16          本程序演示3个定时器的使用, 本例程均使用16位自动重装.
  17          
  18          下载时, 选择时钟 24MHZ (用户可自行修改频率).
  19          
  20          定时器0做16位自动重装, 中断频率为1000HZ，中断函数从P1.7取反输出500HZ方波信号.
  21          
  22          定时器1做16位自动重装, 中断频率为2000HZ，中断函数从P1.6取反输出1000HZ方波信号.
  23          
  24          定时器2做16位自动重装, 中断频率为3000HZ，中断函数从P4.7取反输出1500HZ方波信号.
  25          
  26          ******************************************/
  27          
  28          
  29          #define   MAIN_Fosc   24000000UL  //定义主时钟
  30          
  31          #include  "STC15Fxxxx.H"
  32          
  33          #define Timer0_Reload (MAIN_Fosc / 100000)    //Timer 0 中断频率, 1000次/秒
  34          
  35          
  36          
  37          
  38          //========================================================================
  39          // 函数: void Timer0_init(void)
  40          // 描述: timer0初始化函数.
  41          // 参数: none.
  42          // 返回: none.
  43          // 版本: V1.0, 2015-1-12
  44          //========================================================================
  45          void  Timer0_init(void)
  46          {
  47   1          TR0 = 0;  //停止计数
  48   1      
  49   1        #if (Timer0_Reload < 64)  // 如果用户设置值不合适， 则不启动定时器
                  #error "Timer0设置的中断过快!"
              
                #elif ((Timer0_Reload/12) < 65536UL)  // 如果用户设置值不合适， 则不启动定时器
  53   1          ET0 = 1;  //允许中断
  54   1        //  PT0 = 1;  //高优先级中断
C51 COMPILER V9.60.0.0   TIMER                                                             08/31/2020 23:19:03 PAGE 2   

  55   1          TMOD &= ~0x03;
  56   1          TMOD |= 0;  //工作模式, 0: 16位自动重装, 1: 16位定时/计数, 2: 8位自动重装, 3: 16位自动重装, 不可屏蔽中断
  57   1        //  TMOD |=  0x04;  //对外计数或分频
  58   1          TMOD &= ~0x04;  //定时
  59   1        //  INT_CLKO |=  0x01;  //输出时钟
  60   1          INT_CLKO &= ~0x01;  //不输出时钟
  61   1      
  62   1          #if (Timer0_Reload < 65536UL)
  63   1            AUXR |=  0x80;  //1T mode
  64   1            TH0 = (u8)((65536UL - Timer0_Reload) / 256);
  65   1            TL0 = (u8)((65536UL - Timer0_Reload) % 256);
  66   1          #else
                    AUXR &= ~0x80;  //12T mode
                    TH0 = (u8)((65536UL - Timer0_Reload/12) / 256);
                    TL0 = (u8)((65536UL - Timer0_Reload/12) % 256);
                  #endif
  71   1      
  72   1          TR0 = 1;  //开始运行
  73   1      
  74   1        #else
                  #error "Timer0设置的中断过慢!"
                #endif
  77   1      }
  78          void LED_BLINK(void);
  79          void SendString(char *s);
  80          /*
  81          func:10us定时器,用于中断性周期任务
  82          
  83          */
  84          void timer0_int (void) interrupt TIMER0_VECTOR
  85          {
  86   1        { //  系统正常运行
  87   2          static unsigned long counter=0;
  88   2          counter++;
  89   2          if(counter>100000){   //1s定时器
  90   3            LED_BLINK();        
  91   3            counter=0;
  92   3          }
  93   2        
  94   2        }
  95   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    138    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
